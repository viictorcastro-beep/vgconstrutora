#!/usr/bin/env python3
"""
GERADOR DE PLANTA MASTER 10x26m - VERSÃO 18

CORREÇÕES:
- Casa B: 1 quarto a menos = cômodos recuados = GARAGEM MAIOR na frente
- Corredor externo: começa na lavanderia, vai até o fundo, dobra até suíte
- Fundo: 1.50m (0.50 calçada + 1.00 permeável)
- Cozinha, sala e churrasqueira ENCOSTAM NO MURO (sem corredor externo)
- Entrada: lado ESQUERDO / Garagem (recuo coberto): lado DIREITO

Saída: master_10x26_v18.dxf
"""

import ezdxf
from ezdxf import enums

# ==========================================================
# CONSTANTES
# ==========================================================
SCALE = 1000
LOTE_W, LOTE_L = 5.0, 26.0
MASTER_W, MASTER_L = 10.0, 26.0

FRONT_SETBACK = 1.00

# Corredor externo (no centro, entre as casas)
CORR_EXT_W = 1.10        # largura total do corredor externo
CALCADA_W = 0.50         # calçada (piso morto)
PERM_W = 0.60            # área permeável

# Corredor interno (nas bordas externas)
CORR_INT_W = 1.10

# Fundo
FUNDO_TOTAL = 1.50       # 0.50 calçada + 1.00 permeável
FUNDO_CALC = 0.50
FUNDO_PERM = 1.00

# Dente (entrada + garagem)
ENTRADA_W = 2.00         # entrada lado esquerdo
GARAGEM_W = 3.00         # garagem lado direito
DENTE_RECUO = 2.00       # recuo da garagem

# Profundidades
SALA_L = 4.00
COZINHA_L = 4.00
WC_LAV_L = 2.00
QUARTO_L = 3.50
CLOSET_L = 1.50
SUITE_L = 3.50

WC_W = 1.20
CLOSET_W = 1.00
BWC_SUITE_W = 1.40

# Portas/Janelas
PORTA_ENTRADA = 1.20
PORTA_QUARTO = 0.80
PORTA_WC = 0.70
PORTA_CORRER = 1.40
JANELA_QUARTO = 1.20
JANELA_WC = 0.60
DOOR_EPS = 0.02

CHURRASQ_W = 0.60
HATCH_SCALE = 800
DASH_MM, GAP_MM = 100, 50

# ==========================================================
# HELPERS
# ==========================================================
def setup_layers(doc):
    for name, color in [("PAREDES",7),("DIVISAS",8),("PORTAS",30),("JANELAS",3),
                        ("TEXTOS",5),("COTAS",1),("HATCH_PERM",152),("CALCADA",252),
                        ("CORR_INT",8),("BANCADA",5),("CHURRASQ",1),("ESCADA",8)]:
        if name not in doc.layers:
            doc.layers.add(name, color=color)

def mm(x): return x * SCALE

def rect(msp, x0, y0, x1, y1, layer):
    pts = [(mm(x0),mm(y0)),(mm(x1),mm(y0)),(mm(x1),mm(y1)),(mm(x0),mm(y1))]
    msp.add_lwpolyline(pts, close=True, dxfattribs={"layer": layer})
    return pts

def hatch_rect(msp, x0, y0, x1, y1):
    pts = rect(msp, x0, y0, x1, y1, "HATCH_PERM")
    h = msp.add_hatch(color=152, dxfattribs={"layer": "HATCH_PERM"})
    h.paths.add_polyline_path(pts, is_closed=True)
    h.set_pattern_fill("ANSI31", scale=HATCH_SCALE)

def line(msp, x0, y0, x1, y1, layer="PAREDES", lt=None):
    dxf = {"layer": layer}
    if lt: dxf["linetype"] = lt
    msp.add_line((mm(x0),mm(y0)),(mm(x1),mm(y1)), dxfattribs=dxf)

def window_v(msp, x, y, w):
    msp.add_line((mm(x),mm(y)),(mm(x),mm(y+w)), dxfattribs={"layer":"JANELAS"})

def window_h(msp, x, y, w):
    msp.add_line((mm(x),mm(y)),(mm(x+w),mm(y)), dxfattribs={"layer":"JANELAS"})

def door_v(msp, x, y0, w, swing="R"):
    msp.add_line((mm(x),mm(y0)),(mm(x),mm(y0+w)), dxfattribs={"layer":"PORTAS"})
    if swing == "R":
        msp.add_arc((mm(x),mm(y0)), mm(w), 0, 90, dxfattribs={"layer":"PORTAS"})
        msp.add_line((mm(x),mm(y0)),(mm(x+w),mm(y0)), dxfattribs={"layer":"PORTAS"})
    else:
        msp.add_arc((mm(x),mm(y0)), mm(w), 90, 180, dxfattribs={"layer":"PORTAS"})
        msp.add_line((mm(x),mm(y0)),(mm(x-w),mm(y0)), dxfattribs={"layer":"PORTAS"})

def door_h(msp, x0, y, w, swing="U"):
    msp.add_line((mm(x0),mm(y)),(mm(x0+w),mm(y)), dxfattribs={"layer":"PORTAS"})
    if swing == "U":
        msp.add_arc((mm(x0),mm(y)), mm(w), 0, 90, dxfattribs={"layer":"PORTAS"})
        msp.add_line((mm(x0),mm(y)),(mm(x0),mm(y+w)), dxfattribs={"layer":"PORTAS"})
    else:
        msp.add_arc((mm(x0+w),mm(y)), mm(w), 90, 180, dxfattribs={"layer":"PORTAS"})
        msp.add_line((mm(x0+w),mm(y)),(mm(x0+w),mm(y-w)), dxfattribs={"layer":"PORTAS"})

def sliding_h(msp, x0, y, w):
    msp.add_line((mm(x0),mm(y)),(mm(x0+w),mm(y)), dxfattribs={"layer":"PORTAS"})
    msp.add_line((mm(x0),mm(y+0.08)),(mm(x0+w),mm(y+0.08)), dxfattribs={"layer":"PORTAS"})

def txt(msp, t, x, y, h=100):
    msp.add_text(t, height=h, dxfattribs={"layer":"TEXTOS"}).set_placement(
        (mm(x),mm(y)), align=enums.TextEntityAlignment.MIDDLE_CENTER)

def room_info(msp, name, x0, y0, x1, y1, h=80):
    w, l = abs(x1-x0), abs(y1-y0)
    cx, cy = (x0+x1)/2, (y0+y1)/2
    area = w * l
    txt(msp, name, cx, cy+0.20, h)
    txt(msp, f"{w:.2f}x{l:.2f}", cx, cy-0.05, h*0.6)
    txt(msp, f"{area:.2f}m2", cx, cy-0.28, h*0.6)

def escada(msp, x0, y0, x1, y1, n=5):
    rect(msp, x0, y0, x1, y1, "ESCADA")
    dy = (y1 - y0) / n
    for i in range(1, n):
        line(msp, x0, y0 + i*dy, x1, y0 + i*dy, "ESCADA")

def bancada(msp, x0, y0, x1, y1):
    rect(msp, x0, y0, x1, y1, "BANCADA")

def churrasqueira(msp, x0, y0, x1, y1):
    rect(msp, x0, y0, x1, y1, "CHURRASQ")
    line(msp, x0, y0, x1, y1, "CHURRASQ")
    line(msp, x0, y1, x1, y0, "CHURRASQ")


# ==========================================================
# CASA A (esquerda) - 3 QUARTOS
# ==========================================================
def draw_casa_a(msp):
    """
    Casa A - 3 quartos
    - Corredor INTERNO: borda ESQUERDA (0 a 1.10)
    - Muro divisório: x = 5.00
    - Cozinha/Sala/Churrasqueira ENCOSTAM no muro (x=5)
    - Corredor externo começa na lavanderia até o fundo
    """
    # Geometria X
    ci_x0 = 0.0                          # corredor interno início
    ci_x1 = CORR_INT_W                   # 1.10
    
    muro_x = LOTE_W                      # 5.00 (muro divisório)
    
    # Ambientes (entre corredor interno e muro)
    amb_x0 = ci_x1                       # 1.10
    amb_x1 = muro_x                      # 5.00 (encosta no muro!)
    amb_w = amb_x1 - amb_x0              # 3.90m
    
    # Corredor externo: começa na lavanderia
    # Lateral: do muro (x=5) menos a largura do corredor
    ce_x0 = muro_x - CORR_EXT_W          # 3.90
    ce_x1 = muro_x                       # 5.00
    
    # DENTE NA FRENTE
    ent_x0 = 0.0
    ent_x1 = ENTRADA_W                   # 2.00
    gar_x0 = ent_x1                      # 2.00
    gar_x1 = muro_x                      # 5.00
    
    y_front = FRONT_SETBACK              # 1.00
    y_dente = y_front + DENTE_RECUO      # 3.00
    
    # Profundidades Y
    y_sala = y_dente + SALA_L            # 7.00
    y_coz = y_sala + COZINHA_L           # 11.00
    y_lav = y_coz + WC_LAV_L             # 13.00
    y_q2 = y_lav + QUARTO_L              # 16.50
    y_q1 = y_q2 + QUARTO_L               # 20.00
    
    # Suíte absorve corredor
    suite_x0 = ci_x0                     # 0.00
    suite_x1 = muro_x - CORR_EXT_W       # 3.90 (não encosta no muro, tem corredor)
    
    y_closet = y_q1 + CLOSET_L           # 21.50
    y_suite = y_closet + SUITE_L         # 25.00
    
    # Fundo (1.50m: 0.50 calçada + 1.00 permeável)
    y_fundo_calc = y_suite + FUNDO_CALC  # 25.50
    y_fundo = y_suite + FUNDO_TOTAL      # 26.50 -> ajustar!
    
    # O lote tem 26m, vou ajustar para caber
    y_fundo = LOTE_L                     # 26.00
    y_build = y_fundo - FUNDO_TOTAL      # 24.50
    
    # Recalcular suíte
    suite_l = y_build - y_closet         # 24.50 - 21.50 = 3.00m
    y_suite = y_build
    
    # =======================================================
    # CONTORNO PRINCIPAL
    # =======================================================
    # Cozinha e sala encostam no muro (x=5)
    # Corredor externo só a partir da lavanderia (y_coz)
    pts = [
        # Frente - dente
        (ent_x0, y_front),               # 0, 1
        (ent_x1, y_front),               # 2, 1
        (ent_x1, y_dente),               # 2, 3
        (gar_x1, y_dente),               # 5, 3 (garagem no muro)
        # Sobe pelo muro até cozinha (encostado)
        (muro_x, y_coz),                 # 5, 11 (cozinha encosta no muro)
        # Recua para corredor externo
        (ce_x0, y_coz),                  # 3.9, 11 (começa corredor ext)
        (ce_x0, y_q1),                   # 3.9, 20 (fim corredor int)
        # Suíte (mais larga)
        (suite_x1, y_q1),                # 3.9, 20
        (suite_x1, y_build),             # 3.9, 24.5
        (suite_x0, y_build),             # 0, 24.5
        (suite_x0, y_q1),                # 0, 20
        # Volta pelo corredor interno
        (amb_x0, y_q1),                  # 1.1, 20
        (amb_x0, y_dente),               # 1.1, 3
        (ent_x0, y_dente),               # 0, 3
    ]
    msp.add_lwpolyline([(mm(x),mm(y)) for x,y in pts], close=True, dxfattribs={"layer":"PAREDES"})
    
    # =======================================================
    # CORREDOR INTERNO (termina em y_q1)
    # =======================================================
    rect(msp, ci_x0, y_coz, ci_x1, y_q1, "CORR_INT")
    ci_cx = (ci_x0 + ci_x1) / 2
    line(msp, ci_cx, y_coz, ci_cx, y_q1, "CORR_INT", "DASHED")
    
    # =======================================================
    # CORREDOR EXTERNO (começa na lavanderia, vai até fundo, dobra)
    # =======================================================
    # Lateral (da lavanderia até o fundo)
    calc_x0 = ce_x0
    calc_x1 = ce_x0 + CALCADA_W          # 4.40
    perm_x0 = calc_x1
    perm_x1 = muro_x                     # 5.00
    
    rect(msp, calc_x0, y_coz, calc_x1, y_build, "CALCADA")
    hatch_rect(msp, perm_x0, y_coz, perm_x1, y_build)
    
    # Fundo (dobra para a suíte) - 1.50m total
    rect(msp, suite_x0, y_build, suite_x1, y_build + FUNDO_CALC, "CALCADA")
    hatch_rect(msp, suite_x0, y_build + FUNDO_CALC, suite_x1, y_fundo)
    
    # Canto do fundo (conecta lateral com fundo)
    rect(msp, ce_x0, y_build, muro_x, y_build + FUNDO_CALC, "CALCADA")
    hatch_rect(msp, ce_x0, y_build + FUNDO_CALC, muro_x, y_fundo)
    
    # =======================================================
    # DIVISÓRIAS
    # =======================================================
    line(msp, ent_x1, y_front, ent_x1, y_dente)
    line(msp, ent_x0, y_dente, gar_x1, y_dente)
    line(msp, amb_x0, y_sala, muro_x, y_sala)
    line(msp, amb_x0, y_coz, muro_x, y_coz)
    
    wc_x1 = amb_x0 + WC_W
    line(msp, wc_x1, y_coz, wc_x1, y_lav)
    line(msp, amb_x0, y_lav, ce_x0, y_lav)
    
    line(msp, amb_x0, y_q2, ce_x0, y_q2)
    line(msp, amb_x0, y_q1, ce_x0, y_q1)
    
    closet_x1 = suite_x0 + CLOSET_W
    line(msp, closet_x1, y_q1, closet_x1, y_closet)
    line(msp, suite_x0, y_closet, closet_x1, y_closet)
    
    bwc_x1 = suite_x0 + BWC_SUITE_W
    line(msp, bwc_x1, y_closet, bwc_x1, y_build)
    
    # =======================================================
    # PORTAS
    # =======================================================
    door_h(msp, ent_x0 + 0.40, y_front, PORTA_ENTRADA, "U")
    
    xd = amb_x0 - DOOR_EPS
    door_v(msp, xd, y_coz + 0.20, PORTA_WC, "R")
    sliding_h(msp, wc_x1 + 0.20, y_coz, PORTA_CORRER)
    door_v(msp, xd, y_lav + 0.20, PORTA_QUARTO, "R")
    door_v(msp, xd, y_q2 + 0.20, PORTA_QUARTO, "R")
    door_v(msp, xd, y_q1 + 0.20, PORTA_QUARTO, "R")
    door_h(msp, suite_x0 + 0.20, y_closet, PORTA_WC, "U")
    
    # =======================================================
    # JANELAS
    # =======================================================
    window_v(msp, amb_x0, y_dente + 1.00, JANELA_QUARTO)
    window_v(msp, ce_x0, (y_lav + y_q2)/2 - 0.60, JANELA_QUARTO)
    window_v(msp, ce_x0, (y_q2 + y_q1)/2 - 0.60, JANELA_QUARTO)
    window_v(msp, ce_x0, (y_coz + y_lav)/2 - 0.30, JANELA_WC)
    # Janela suíte no fundo (corredor externo dobra até aqui)
    window_h(msp, (bwc_x1 + suite_x1)/2 - 0.60, y_build, JANELA_QUARTO)
    window_v(msp, suite_x0, (y_closet + y_build)/2 - 0.30, JANELA_WC)
    
    # =======================================================
    # PORTÃO
    # =======================================================
    msp.add_line((mm(0),mm(0)),(mm(LOTE_W),mm(0)), dxfattribs={"layer":"PORTAS","lineweight":50})
    txt(msp, "PORTAO", LOTE_W/2, -0.30, 80)
    
    # =======================================================
    # CHURRASQUEIRA (encosta no muro)
    # =======================================================
    churr_x0 = muro_x - CHURRASQ_W
    churr_y0 = y_lav - CHURRASQ_W - 0.20
    churrasqueira(msp, churr_x0, churr_y0, muro_x, churr_y0 + CHURRASQ_W)
    bancada(msp, churr_x0, y_coz + 0.20, muro_x, churr_y0)
    escada(msp, ce_x0, y_coz, ce_x0 + 0.60, y_coz + 1.00, 4)
    
    # =======================================================
    # TEXTOS
    # =======================================================
    txt(msp, "ENTRADA", (ent_x0+ent_x1)/2, (y_front+y_dente)/2, 55)
    room_info(msp, "GARAGEM", gar_x0, y_front, gar_x1, y_dente, 55)
    room_info(msp, "SALA", amb_x0, y_dente, muro_x, y_sala, 60)
    room_info(msp, "COZINHA", amb_x0, y_sala, muro_x, y_coz, 60)
    room_info(msp, "WC", amb_x0, y_coz, wc_x1, y_lav, 45)
    room_info(msp, "LAV", wc_x1, y_coz, ce_x0, y_lav, 45)
    room_info(msp, "QUARTO", amb_x0, y_lav, ce_x0, y_q2, 60)
    room_info(msp, "QUARTO", amb_x0, y_q2, ce_x0, y_q1, 60)
    room_info(msp, "CLOSET", suite_x0, y_q1, closet_x1, y_closet, 40)
    room_info(msp, "SUITE", bwc_x1, y_closet, suite_x1, y_build, 55)
    room_info(msp, "WC", suite_x0, y_closet, bwc_x1, y_build, 40)
    txt(msp, "CORR", ci_cx, (y_coz+y_q1)/2, 45)
    
    print(f"CASA A (3Q):")
    print(f"  Amb largura: {amb_w:.2f}m (encosta no muro)")
    print(f"  Quartos: {ce_x0-amb_x0:.2f} x {QUARTO_L:.2f} = {(ce_x0-amb_x0)*QUARTO_L:.2f}m²")
    
    return {"y_build": y_build}


# ==========================================================
# CASA B (direita) - 2 QUARTOS
# ==========================================================
def draw_casa_b(msp):
    """
    Casa B - 2 quartos (1 quarto a menos)
    - Cômodos RECUADOS = garagem MAIOR na frente
    - Corredor INTERNO: borda DIREITA (8.90 a 10)
    - Muro divisório: x = 5.00
    """
    lot_x0 = 5.0
    lot_x1 = 10.0
    
    # Geometria X
    ci_x0 = lot_x1 - CORR_INT_W          # 8.90
    ci_x1 = lot_x1                       # 10.00
    
    muro_x = lot_x0                      # 5.00 (muro divisório)
    
    # Ambientes (entre muro e corredor interno)
    amb_x0 = muro_x                      # 5.00 (encosta no muro!)
    amb_x1 = ci_x0                       # 8.90
    amb_w = amb_x1 - amb_x0              # 3.90m
    
    # Corredor externo (do muro para dentro)
    ce_x0 = muro_x                       # 5.00
    ce_x1 = muro_x + CORR_EXT_W          # 6.10
    
    # DENTE - Casa B tem GARAGEM MAIOR (recuo extra por ter 1Q a menos)
    # Entrada: lado esquerdo (junto ao muro)
    # Garagem: lado direito (recuada)
    ent_x0 = lot_x0                      # 5.00
    ent_x1 = lot_x0 + ENTRADA_W          # 7.00
    gar_x0 = ent_x1                      # 7.00
    gar_x1 = lot_x1                      # 10.00
    
    y_front = FRONT_SETBACK              # 1.00
    
    # Casa B: garagem maior por ter 1 quarto a menos
    # O recuo é maior para compensar o quarto que não existe
    DENTE_RECUO_B = DENTE_RECUO + QUARTO_L  # 2.00 + 3.50 = 5.50m
    y_dente = y_front + DENTE_RECUO_B    # 6.50 (garagem bem maior!)
    
    # Profundidades Y (mesmas, mas partindo de y_dente maior)
    y_sala = y_dente + SALA_L            # 10.50
    y_coz = y_sala + COZINHA_L           # 14.50
    y_lav = y_coz + WC_LAV_L             # 16.50
    y_q1 = y_lav + QUARTO_L              # 20.00 (só 1 quarto!)
    
    # Suíte absorve corredor
    suite_x0 = ce_x1                     # 6.10 (não encosta no muro, tem corredor)
    suite_x1 = ci_x1                     # 10.00
    
    y_closet = y_q1 + CLOSET_L           # 21.50
    
    y_fundo = LOTE_L                     # 26.00
    y_build = y_fundo - FUNDO_TOTAL      # 24.50
    
    suite_l = y_build - y_closet         # 3.00m
    y_suite = y_build
    
    # =======================================================
    # CONTORNO
    # =======================================================
    pts = [
        (ent_x0, y_front),               # 5, 1
        (ent_x1, y_front),               # 7, 1
        (ent_x1, y_dente),               # 7, 6.5
        (gar_x1, y_dente),               # 10, 6.5
        (gar_x1, y_coz),                 # 10, 14.5
        (amb_x1, y_coz),                 # 8.9, 14.5
        # Sobe pelo muro até cozinha
        (muro_x, y_coz),                 # 5, 14.5 (cozinha encosta no muro)
        (muro_x, y_dente),               # 5, 6.5
        (ent_x0, y_dente),               # 5, 6.5
    ]
    # Corrigir contorno para incluir quartos e suíte
    pts = [
        # Frente
        (ent_x0, y_front),               # 5, 1
        (ent_x1, y_front),               # 7, 1
        (ent_x1, y_dente),               # 7, 6.5
        (gar_x1, y_dente),               # 10, 6.5
        # Sobe pela lateral direita
        (gar_x1, y_coz),                 # 10, 14.5 (ajustar)
        # Volta para linha dos ambientes
        (amb_x1, y_coz),                 # 8.9, 14.5
        (amb_x1, y_q1),                  # 8.9, 20 (fim corredor int)
        # Suíte
        (suite_x1, y_q1),                # 10, 20
        (suite_x1, y_build),             # 10, 24.5
        (suite_x0, y_build),             # 6.1, 24.5
        (suite_x0, y_q1),                # 6.1, 20
        # Volta
        (ce_x1, y_q1),                   # 6.1, 20
        (ce_x1, y_coz),                  # 6.1, 14.5 (corredor ext)
        (muro_x, y_coz),                 # 5, 14.5 (muro)
        (muro_x, y_dente),               # 5, 6.5
        (ent_x0, y_dente),               # 5, 6.5
    ]
    msp.add_lwpolyline([(mm(x),mm(y)) for x,y in pts], close=True, dxfattribs={"layer":"PAREDES"})
    
    # =======================================================
    # CORREDOR INTERNO
    # =======================================================
    rect(msp, ci_x0, y_coz, ci_x1, y_q1, "CORR_INT")
    ci_cx = (ci_x0 + ci_x1) / 2
    line(msp, ci_cx, y_coz, ci_cx, y_q1, "CORR_INT", "DASHED")
    
    # =======================================================
    # CORREDOR EXTERNO
    # =======================================================
    perm_x0 = muro_x
    perm_x1 = muro_x + PERM_W            # 5.60
    calc_x0 = perm_x1
    calc_x1 = ce_x1                      # 6.10
    
    hatch_rect(msp, perm_x0, y_coz, perm_x1, y_build)
    rect(msp, calc_x0, y_coz, calc_x1, y_build, "CALCADA")
    
    # Fundo
    hatch_rect(msp, muro_x, y_build, suite_x0, y_build + FUNDO_PERM)
    rect(msp, muro_x, y_build + FUNDO_PERM, suite_x0, y_fundo, "CALCADA")
    hatch_rect(msp, suite_x0, y_build, suite_x1, y_build + FUNDO_PERM)
    rect(msp, suite_x0, y_build + FUNDO_PERM, suite_x1, y_fundo, "CALCADA")
    
    # =======================================================
    # DIVISÓRIAS
    # =======================================================
    line(msp, ent_x1, y_front, ent_x1, y_dente)
    line(msp, ent_x0, y_dente, gar_x1, y_dente)
    line(msp, muro_x, y_sala, amb_x1, y_sala)
    line(msp, muro_x, y_coz, amb_x1, y_coz)
    
    wc_x0 = amb_x1 - WC_W
    line(msp, wc_x0, y_coz, wc_x0, y_lav)
    line(msp, ce_x1, y_lav, amb_x1, y_lav)
    
    line(msp, ce_x1, y_q1, amb_x1, y_q1)
    
    closet_x0 = suite_x1 - CLOSET_W
    line(msp, closet_x0, y_q1, closet_x0, y_closet)
    line(msp, closet_x0, y_closet, suite_x1, y_closet)
    
    bwc_x0 = suite_x1 - BWC_SUITE_W
    line(msp, bwc_x0, y_closet, bwc_x0, y_build)
    
    # =======================================================
    # PORTAS
    # =======================================================
    door_h(msp, ent_x0 + 0.40, y_front, PORTA_ENTRADA, "U")
    
    xd = amb_x1 + DOOR_EPS
    door_v(msp, xd, y_coz + 0.20, PORTA_WC, "L")
    sliding_h(msp, ce_x1 + 0.20, y_coz, PORTA_CORRER)
    door_v(msp, xd, y_lav + 0.20, PORTA_QUARTO, "L")
    door_v(msp, xd, y_q1 + 0.20, PORTA_QUARTO, "L")
    door_h(msp, suite_x1 - PORTA_WC - 0.20, y_closet, PORTA_WC, "U")
    
    # =======================================================
    # JANELAS
    # =======================================================
    window_v(msp, amb_x1, y_dente + 1.00, JANELA_QUARTO)
    window_v(msp, ce_x1, (y_lav + y_q1)/2 - 0.60, JANELA_QUARTO)
    window_v(msp, ce_x1, (y_coz + y_lav)/2 - 0.30, JANELA_WC)
    window_h(msp, (suite_x0 + bwc_x0)/2 - 0.60, y_build, JANELA_QUARTO)
    window_v(msp, suite_x1, (y_closet + y_build)/2 - 0.30, JANELA_WC)
    
    # =======================================================
    # PORTÃO
    # =======================================================
    msp.add_line((mm(lot_x0),mm(0)),(mm(lot_x1),mm(0)), dxfattribs={"layer":"PORTAS","lineweight":50})
    txt(msp, "PORTAO", (lot_x0+lot_x1)/2, -0.30, 80)
    
    # =======================================================
    # CHURRASQUEIRA
    # =======================================================
    churr_x1 = muro_x + CHURRASQ_W
    churr_y0 = y_lav - CHURRASQ_W - 0.20
    churrasqueira(msp, muro_x, churr_y0, churr_x1, churr_y0 + CHURRASQ_W)
    bancada(msp, muro_x, y_coz + 0.20, churr_x1, churr_y0)
    escada(msp, ce_x1 - 0.60, y_coz, ce_x1, y_coz + 1.00, 4)
    
    # =======================================================
    # TEXTOS
    # =======================================================
    txt(msp, "ENTRADA", (ent_x0+ent_x1)/2, (y_front+y_dente)/2, 55)
    room_info(msp, "GARAGEM", gar_x0, y_front, gar_x1, y_dente, 55)
    room_info(msp, "SALA", muro_x, y_dente, amb_x1, y_sala, 60)
    room_info(msp, "COZINHA", muro_x, y_sala, amb_x1, y_coz, 60)
    room_info(msp, "LAV", ce_x1, y_coz, wc_x0, y_lav, 45)
    room_info(msp, "WC", wc_x0, y_coz, amb_x1, y_lav, 45)
    room_info(msp, "QUARTO", ce_x1, y_lav, amb_x1, y_q1, 60)
    room_info(msp, "CLOSET", closet_x0, y_q1, suite_x1, y_closet, 40)
    room_info(msp, "SUITE", suite_x0, y_closet, bwc_x0, y_build, 55)
    room_info(msp, "WC", bwc_x0, y_closet, suite_x1, y_build, 40)
    txt(msp, "CORR", ci_cx, (y_coz+y_q1)/2, 45)
    
    # Área garagem maior
    gar_area = (gar_x1 - gar_x0) * (y_dente - y_front)
    print(f"\nCASA B (2Q):")
    print(f"  GARAGEM MAIOR: {gar_x1-gar_x0:.2f} x {y_dente-y_front:.2f} = {gar_area:.2f}m²")
    print(f"  (1 quarto a menos = cômodos recuados)")
    
    return {"y_build": y_build}


# ==========================================================
# MAIN
# ==========================================================
def main():
    doc = ezdxf.new("R2010")
    msp = doc.modelspace()
    setup_layers(doc)
    
    doc.header["$INSUNITS"] = 4
    doc.header["$LTSCALE"] = 1
    
    if "DASHED" not in doc.linetypes:
        doc.linetypes.add("DASHED", description="Dashed", pattern=[DASH_MM, -GAP_MM])
    
    msp.add_lwpolyline([(0,0),(mm(MASTER_W),0),(mm(MASTER_W),mm(MASTER_L)),(0,mm(MASTER_L))],
                       close=True, dxfattribs={"layer":"DIVISAS"})
    line(msp, 5.0, 0, 5.0, MASTER_L, "DIVISAS")
    
    print("="*60)
    print("DXF v18 - CASA B COM GARAGEM MAIOR (1Q A MENOS)")
    print("="*60)
    
    draw_casa_a(msp)
    draw_casa_b(msp)
    
    txt(msp, "CASA A (3Q)", 2.5, -0.70, 120)
    txt(msp, "CASA B (2Q)", 7.5, -0.70, 120)
    
    filename = "master_10x26_v18.dxf"
    doc.saveas(filename)
    
    print("\n" + "="*60)
    print(f"ARQUIVO: {filename}")
    print("="*60)

if __name__ == "__main__":
    main()